(()=>{"use strict";const WNUM="00971552761095",PASS="6974",SECS=20;function $(s,p=document){return p.querySelector(s)}function E(t,a={},c=""){const e=document.createElement(t);for(const k in a)e.setAttribute(k,a[k]);if(c) e.innerHTML=c;return e}function css(){const s=E("style",{},`*{box-sizing:border-box}body{margin:0;background:#0b132b;color:#f5f7fa;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica Neue,Arial}a{color:#ff2fb3}.wrap{max-width:840px;margin:0 auto;padding:24px}.card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}h1{font-size:28px;margin:0 0 8px}h2{font-size:20px;margin:16px 0 8px}p{color:#c3d0e0}.row{display:flex;gap:12px;flex-wrap:wrap}.btn{background:#ff2fb3;border:0;color:#042a2b;padding:12px 16px;border-radius:14px;font-weight:700;cursor:pointer}.btn:disabled{opacity:.5;cursor:not-allowed}.btn.secondary{background:#3a506b;color:#e9f1f7}.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.18);color:#f5f7fa}.input,select{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:#f5f7fa}.muted{color:#c3d0e0;font-size:12px}.progress{height:8px;background:rgba(255,255,255,.1);border-radius:999px;overflow:hidden;margin:6px 0 14px}.progress>div{height:100%;width:0;background:linear-gradient(90deg,#64dfdf,#80ffdb);transition:width .25s ease}.badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;background:rgba(255,255,255,.08);color:#c3d0e0}.qnum{color:#c3d0e0;font-weight:700}.table{width:100%;border-collapse:collapse}.table th,.table td{border-bottom:1px dashed rgba(255,255,255,.15);padding:8px 6px;text-align:left}.pill{padding:4px 8px;border-radius:999px;font-size:12px;background:rgba(255,255,255,.08);color:#f5f7fa}.hidden{display:none!important}.timer-ring{width:40px;height:40px;position:relative}.timer-ring svg{position:absolute;inset:0;transform:rotate(-90deg)}.timer-ring .ring-bg{stroke:rgba(255,255,255,.18);stroke-width:6;fill:none}.timer-ring .ring-fg{stroke:#ff2fb3;stroke-width:6;fill:none;stroke-linecap:round;transition:stroke-dashoffset .25s linear}.timer-ring .ring-center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:12px;color:#f5f7fa}`);document.head.appendChild(s)}function html(){const w=E("div",{class:"wrap"});w.innerHTML=`<div class=topbar><div class=brand><div style="width:44px;height:44px;border-radius:12px;background:#fff;display:flex;align-items:center;justify-content:center"><span style=color:#ff2fb3;font-weight:800>TX</span></div><div><h1>Trade Finance Quiz</h1><div class=muted>LC · Murabaha · Wakalah</div></div></div></div>
<section id=intro class=card><h2>Before we start</h2><p>Type your name to begin. You will answer <b>20 professional MCQs</b>. At the end, download Excel and send via WhatsApp.</p><div class=grid><div><label class=muted for=pname>Your name</label><input id=pname class=input maxlength=40 placeholder="Type your name"/></div></div><div class=row style="margin-top:14px"><button id=startBtn class=btn disabled>Start Quiz</button><button id=qrBtn class="btn ghost">Show QR</button></div><div id=qrWrap class=hidden style="margin-top:10px;display:flex;gap:14px;align-items:center"><div id=qr style="background:#fff;padding:12px;border-radius:12px;"></div><div class=muted id=qrNote>Scan to open this quiz on your phone.</div></div></section>
<section id=quiz class="card hidden"><div class=row style="align-items:center;justify-content:space-between"><div><span class=badge id=who>Player: <span id=playerName></span></span></div><div class=qnum>Question <span id=qIndex>1</span>/<span id=qTotal></span></div><div class=row style="align-items:center;gap:10px"><div class=timer-ring><svg width=40 height=40 viewBox="0 0 40 40"><circle class=ring-bg cx=20 cy=20 r=16></circle><circle class=ring-fg id=ringFg cx=20 cy=20 r=16></circle></svg><div class=ring-center id=ringText>20</div></div><div class=badge id=timerBadge>Time left: <span id=timer>20s</span></div></div></div><div class=progress><div id=progFill></div></div><h2 id=qText>...</h2><div id=options></div><div class=row style="margin-top:12px"><button id=nextBtn class=btn>Next</button></div></section>
<section id=result class="card hidden"><h2>Results</h2><p><b id=rName></b>, you scored <b id=rScore></b>/<span id=rTotal></span>.</p><table class=table id=reviewTable><thead><tr><th>#</th><th>Topic</th><th>Question</th><th>Your Answer</th><th>Correct</th><th>Status</th></tr></thead><tbody></tbody></table><div class=row style=margin-top:12px><button id=downloadBtn class=btn>Download Excel</button><button id=sendBtn class="btn secondary">Exit & Send on WhatsApp</button><button id=againBtn class="btn ghost">Take Again</button></div></section>
<div class=footer style="margin-top:16px;font-size:12px;color:#c3d0e0">© 2025 • TradeXcel • No server required.</div>`;document.body.appendChild(w)}function loadDeps(){return new Promise(r=>{const L=[["XLSX",["https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js","https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js","https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"]],["QRCode",["https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js","https://unpkg.com/qrcode@1.5.1/build/qrcode.min.js"]]];const s=u=>new Promise((res,rej)=>{const t=E("script",{src:u});t.onload=()=>res(1);t.onerror=()=>rej();document.head.appendChild(t)});(async()=>{for(const [k,urls] of L){let ok=false;for(const u of urls){try{await s(u);if(window[k]){ok=true;break}}catch{}}}r(1)})()})}
const QUIZ=[{topic:"Documentary Credit",q:"Under an irrevocable documentary credit, the issuing bank's undertaking is to:",options:["Honor or negotiate upon a complying presentation","Guarantee the physical quality of the goods","Automatically finance the buyer's purchase order","Release the goods from customs on arrival"],correct:0},{topic:"Documentary Credit",q:"What does a 'complying presentation' mean under UCP 600?",options:["Documents appear on their face to comply with the credit terms, UCP 600 and applicable ISBP","Goods are physically inspected by the bank","Buyer confirms acceptance after delivery","Shipment occurs within 10 calendar days of LC issuance"],correct:0},{topic:"Documentary Credit",q:"Within what timeframe must banks determine if a presentation is complying (UCP 600 Art. 14)?",options:["Two banking days following the day of presentation","Five banking days following the day of presentation","Thirty calendar days from shipment date","By the LC expiry date, whichever is later"],correct:1},{topic:"Documentary Credit",q:"Which transport document evidences shipment by sea under a credit?",options:["Air waybill (AWB)","Road consignment note (CMR)","Bill of lading indicating 'on board'","Courier receipt"],correct:2},{topic:"Documentary Credit",q:"Which is a typical discrepancy at document checking?",options:["Invoice description matches the LC exactly","Bill of lading dated after the latest shipment date in the LC","Draft drawn at the tenor required by the LC","Insurance cover not less than 110% of CIF value as required"],correct:1},{topic:"Murabaha",q:"In a Murabaha to the Purchase Orderer (MPO), which sequence satisfies Shariah requirements?",options:["Customer pays the bank first; the bank then purchases and sells the goods","Bank purchases and assumes title/possession, then sells to the customer on a cost-plus deferred basis","Customer purchases from the supplier and the bank reimburses later","Bank lends cash to the customer with interest to buy the goods"],correct:1},{topic:"Murabaha",q:"In Murabaha, the bank's profit is:",options:["Undisclosed and variable","Disclosed and agreed upfront","Interest on the outstanding balance","Prohibited in all cases"],correct:1},{topic:"Murabaha",q:"Which costs may be included in the Murabaha cost price?",options:["Only the ex‑works tag price","Any costs not disclosed","Actual purchase price plus disclosed, permissible related costs","Late payment penalties charged to the customer"],correct:2},{topic:"Wakalah",q:"Wakalah is best described as:",options:["Suretyship (kafalah)","Agency whereby the principal appoints an agent to act on their behalf","A gratuitous gift (hibah)","A lease (ijarah)"],correct:1},{topic:"Wakalah",q:"Under a Wakalah investment arrangement, which statement is correct?",options:["The wakil guarantees the principal against loss in all cases","Profit/loss belongs to the wakil, not the principal","The wakil earns an agency fee; losses (absent negligence/misconduct) are borne by the principal","The wakil may act contrary to the mandate if opportunities arise"],correct:2},{topic:"Documentary Credit",q:"A credit 'available with any bank by negotiation' means the beneficiary may present a complying presentation to:",options:["Any bank that agrees to negotiate","Only the issuing bank","Only the advising bank","Only the confirming bank"],correct:0},{topic:"Documentary Credit",q:"A confirmed credit adds the independent undertaking of the:",options:["Confirming bank","Applicant (buyer)","Advising bank (when not confirming)","Carrier"],correct:0},{topic:"Documentary Credit",q:"Unless otherwise specified, the place for presentation under a credit is:",options:["The bank with which the credit is available; if none, the issuing bank","The port of loading","The buyer's office","The seller's forwarder"],correct:0},{topic:"Documentary Credit",q:"If the credit is silent, documents must be presented:",options:["Within 21 days after shipment but not later than the expiry date","Within 7 banking days of shipment","Within 30 days after expiry","On the invoice date"],correct:0},{topic:"Documentary Credit",q:"If a credit is silent on partial shipments, they are:",options:["Prohibited","Allowed","Allowed only by air","Allowed only with issuing bank consent after shipment"],correct:1},{topic:"Documentary Credit",q:"Under UCP 600, 'negotiation' means:",options:["Document examination only","Purchase by the nominated bank of drafts/documents under a complying presentation","Payment on maturity without advancing funds","LC issuance by the issuing bank"],correct:1},{topic:"Documentary Credit",q:"Under a credit available by acceptance, the draft is typically drawn on:",options:["The accepting bank specified in the credit","The buyer (applicant)","Any bank chosen by the beneficiary","The carrier"],correct:0},{topic:"Murabaha",q:"In Murabaha, late payment penalties (if stipulated) should be:",options:["Recognized as bank income","Donated to charity; only actual collection costs may be retained","Capitalized into the cost price as extra profit","Paid to the supplier as a rebate"],correct:1},{topic:"Murabaha",q:"In a Murabaha with Wakalah (customer as purchasing agent), Shariah compliance requires that:",options:["Title/possession must pass to the bank before the onward Murabaha sale","The customer may purchase in their own name and resell to themselves","The bank bears no ownership risk at any time","The agent may exceed the mandate without consequences"],correct:0},{topic:"Wakalah",q:"Under a Wakalah investment arrangement, the wakil's remuneration is typically:",options:["A fixed agency fee (and, if agreed, an incentive); profit/loss belongs to the principal unless negligence/misconduct","A default share of profit like a mudarib","A guaranteed percentage of capital regardless of outcome","Payable only when profit is generated"],correct:0}];
let idx=0,answers=new Array(QUIZ.length).fill(null),timer=null,timeLeft=SECS;let qText,qIndex,qTotal,progFill,optionsBox,playerNameEl,startBtnEl,downloadBtn,sendBtn,ringFg,ringText,timerEl,quizEl,introEl,resultEl;const R=16,C=2*Math.PI*R;function shuffle(){for(let i=QUIZ.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[QUIZ[i],QUIZ[j]]=[QUIZ[j],QUIZ[i]]}}function resetTimer(){if(timer)clearInterval(timer);timeLeft=SECS;timerEl.textContent=timeLeft+"s";ringText.textContent=String(timeLeft);ringFg.style.strokeDasharray=String(C);ringFg.style.strokeDashoffset="0";timer=setInterval(()=>{timeLeft--;if(timeLeft<0)timeLeft=0;timerEl.textContent=timeLeft+"s";ringText.textContent=String(timeLeft);ringFg.style.strokeDashoffset=String(C*(1-timeLeft/SECS));if(timeLeft<=0){clearInterval(timer);timer=null;if(answers[idx]===null)answers[idx]=-1;next()}},1e3)}function render(){const q=QUIZ[idx];qText.textContent=q.q;qIndex.textContent=String(idx+1);qTotal.textContent=String(QUIZ.length);progFill.style.width=Math.round(idx/QUIZ.length*100)+"%";optionsBox.innerHTML="";q.options.forEach((op,i)=>{const lab=E("label",{},`<input type=radio name=q${idx}/> ${op}`);lab.querySelector("input").addEventListener("change",()=>{answers[idx]=i});optionsBox.appendChild(lab)});resetTimer()}function start(name){$("#playerName").textContent=name;shuffle();answers=new Array(QUIZ.length).fill(null);idx=0;introEl.classList.add("hidden");quizEl.classList.remove("hidden");render()}function next(){if(timer){clearInterval(timer);timer=null}if(idx<QUIZ.length-1){idx++;render()}else finish()}function score(){return answers.reduce((a,v,i)=>a+(v===QUIZ[i].correct?1:0),0)}function finish(){quizEl.classList.add("hidden");resultEl.classList.remove("hidden");$("#rName").textContent=$("#playerName").textContent;$("#rScore").textContent=String(score());$("#rTotal").textContent=String(QUIZ.length);const body=$("#reviewTable tbody");body.innerHTML="";QUIZ.forEach((q,i)=>{const your=answers[i]===-1?"Not attended":(answers[i]==null?"—":q.options[answers[i]]);const ok=answers[i]===q.correct;const tr=E("tr",{},`<td>${i+1}</td><td><span class=pill>${q.topic}</span></td><td>${q.q}</td><td>${your}</td><td>${q.options[q.correct]}</td><td>${ok?'<span style="color:#31c48d;font-weight:700">Correct</span>':'<span style="color:#f05252;font-weight:700">Wrong</span>'}</td>`);body.appendChild(tr)});downloadBtn.onclick=()=>exportXLSX(false);sendBtn.onclick=()=>exportXLSX(true);$("#againBtn").onclick=()=>{answers=new Array(QUIZ.length).fill(null);idx=0;resultEl.classList.add("hidden");introEl.classList.remove("hidden");$("#pname").value="";startBtnEl.disabled=true}}function rowObj(){const r={Timestamp:new Date().toISOString().replace('T',' ').substring(0,19),Name:$("#playerName").textContent,Score:score()};QUIZ.forEach((q,i)=>{let letter="";if(answers[i]===-1)letter="NA";else if(answers[i]!=null)letter=["A","B","C","D"][answers[i]]||"";r["Q"+(i+1)]=letter});return r}function exportXLSX(openWA){const r=rowObj(),h=["Timestamp","Name","Score"];for(let i=1;i<=QUIZ.length;i++)h.push("Q"+i);const ws=XLSX.utils.json_to_sheet([r],{header:h}),wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"Responses");const safe=($("#playerName").textContent||"Participant").replace(/[^a-z0-9\- ]/gi,"_");XLSX.writeFile(wb,`TradeFinanceQuiz_${safe}_${Date.now()}.xlsx`);if(openWA){const msg=`Hello, I finished the Trade Finance Quiz.\nName: ${$("#playerName").textContent}\nScore: ${r.Score}/${QUIZ.length}\nI am attaching my Excel file now.`,u=`https://wa.me/${WNUM}?text=${encodeURIComponent(msg)}`;setTimeout(()=>window.open(u,"_blank"),400)}}function qr(){const url=location.href.split("?")[0].split("#")[0];const c=document.createElement("canvas");$("#qr").innerHTML="";$("#qr").appendChild(c);if(window.QRCode&&QRCode.toCanvas)QRCode.toCanvas(c,url,{width:256,margin:4},()=>{});else $("#qr").innerHTML='<div class=muted>QR lib not loaded</div>'}
function init(){css();html();qText=$("#qText");qIndex=$("#qIndex");qTotal=$("#qTotal");progFill=$("#progFill");optionsBox=$("#options");playerNameEl=$("#playerName");startBtnEl=$("#startBtn");downloadBtn=$("#downloadBtn");sendBtn=$("#sendBtn");ringFg=$("#ringFg");ringText=$("#ringText");timerEl=$("#timer");quizEl=$("#quiz");introEl=$("#intro");resultEl=$("#result");$("#pname").addEventListener("input",e=>{startBtnEl.disabled=(e.target.value.trim().length<2)});$("#qrBtn").onclick=()=>{$("#qrWrap").classList.toggle("hidden");if(!$("#qrWrap").classList.contains("hidden"))qr()};$("#nextBtn").onclick=next;startBtnEl.onclick=()=>start($("#pname").value.trim());loadDeps()}document.readyState!="loading"?init():document.addEventListener("DOMContentLoaded",init)})();
